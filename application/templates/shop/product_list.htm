<link rel="stylesheet" href="/static/wap/search_list.css?v=<{$vsersion}>" />
<div style="clear:both; margin-top:45px;"> </div>
<div class="nav_list">
  <div class="search-list">
    <ul id="searchSort20" class="new-search-tab bdr-bom">
      <li class="new-change-eleven new-sort-integrative active" id="search1"><span>推荐</span></li>
      <li class="new-change-eleven " id="search2"><span>销量</span></li>
      <li class="new-change-eleven new-sort-price " id="search3"><span>价格</span></li>
      <li class="new-change-eleven" id="search4"><span>筛选<span class="choose-icon"></span></span></li>
    </ul>
    <div style=" clear:both;border:0; height:0px; border-bottom:1px solid red; background:#000; margin:0; padding:0;"></div>
  </div>
  <div id="search11" class="integrative-box show-position hide">
    <ul class="integrative-list">
      <li  id="search12" class="sidebar-iteam checked" ><span><i class="tick"></i><span class="sort-of-brand">推荐</span></span></li>
      <li  id="search13" class="sidebar-iteam" ><span><i class="tick"></i><span class="sort-of-brand">新品</span></span></li>
      <li  id="search14" class="sidebar-iteam"><span><i class="tick"></i><span class="sort-of-brand">热点</span></span></li>
    </ul>
  </div>
</div>
<div style="clear:both; margin-top:90px;"> </div>
<div  id='con_list' class="countdown1"> <{foreach item=item  key=key from=$re.list}>
  <div id="m_left1"> <a tag="countdown" href="<{"product/detail"|site_url}>?id=<{$item.id}>"><img  src="<{$item.pic}>" /></a></div>
  <div id="m_content1">
    <div id="m_contentInner1">
      <div class="content">
        <div class="tt"><a href="<{"product/detail"|site_url}>?id=<{$item.id}>"><{$item.name}></a></div>
        <div class="price"> <em>¥<i><{$item.price}></i> </em> <del>¥ <{$item.market_price}></del> </div>
        <a class="cou-btn cou-btn2" href="<{'cart/add_cart'|base_site_url:'u'}>?id=<{$item.id}>">加入购物车</a> </div>
    </div>
  </div>
  <div style="clear:both;"></div>
  <{/foreach}> </div>
<div style="clear:both;"></div>
<div id='auto_msg' data-check='0' style="text-align:center; background:#fff; margin-top:10px; display:none;"  >数据加载中.........</div>
</div>
<div id='search_con'  class="m-popCover new-filtrate  hide">
  <div class="filtrate-block" id='s_con1' >
    <div class="filtrate-index ">
      <div id='s_con' class="index-ofyauto">
        <div>
          <div class="title-line2"> <span class="title">价格区间</span></div>
          <div class="price-section">
            <div class="from-to">
              <input  id="search_minPrice" class="search_param"  data-v='search_minPrice:value' type="number" value="<{$smarty.get.minPrice}>" pattern="[0-9]*" placeholder="最低价">
              <span></span>
              <input  id="search_maxPrice" class="search_param"  data-v='search_maxPrice:value' type="number" value="<{$smarty.get.maxPrice}>" pattern="[0-9]*" placeholder="最高价">
            </div>
          </div>
        </div>
        <div class="line1" id='cat_show'>
          <div class="title-line3" ><span class="all"><s class="search_param"  data-v='search_cat:null' id='selected_cat'></s> <i></i></span><span class="title">全部分类</span> </div>
          <div class="clear"></div>
        </div>
        
        <div id='gg_brand'  class="search_param"  data-v='search_brand:0' class="line1">
          <div class="title-line2 bottom-title"> <span class="title">品牌</span> <span class="selected"></span> <i id="open" class="down"></i> </div>
          <div class="clear"></div>
          <div class="brand_list" id='brand_list'>
            <!--div><span  class="active"><i></i>阿斯asd达</span></div-->
            
            <div class="clear"></div>
          </div>
        </div>
        
        
        <div class="clear"></div>
        <{*类型规格*}>
        <div id='gg_con' class="search_param"  data-v="search_gg:0">
        	
        </div>
        <div class="clear"></div>
      </div>
      
      
      <div id='s_con_cat' class="index-ofyauto hide">
      <div class="right-head">
        <div id="catelogy_back" class="back"><i></i></div>
        <div class="heat-title"><span>全部分类</span></div>
      </div>
      <span id="catelogy_selectAll" class="fix-classify"><span>全部分类</span><i class=""></i></span>
      <ul class="classify-ul" style="overflow:auto;" >
        <{foreach item=item key=k from=$re.cat_list}>
        <{if $item.pid==0}>  
        <{if $k!=0}>
        </div>
        <{/if}>
        <li> 
           <span><{$item.cat}></span><i class="up"></i> </li>
           <div class="hide"> <{else}> <span class="item_cat" data-cat='{"id":"<{$item.id}>","cat":"<{$item.cat|escape:"url"}>"}'> <{$item.cat}> <s></s> <i></i> </span><{/if}>
        <{/foreach}> 
        </div>
      </ul>
    </div>
    <div id="indexbnts" class="index-bnts">
      <div id="reset"  class="left">重置</div>
      <div id="submit" class="right">确定</div>
    </div>
  </div>
</div>
</div>
<div id="SearchCover" class="mzjx-floor hide">
  <div class="cover-floor"> </div>
</div>
<script>

var resetall=function(){
	$('.integrative-list>li').removeClass('checked');
	$('#searchSort20>li').removeClass('active');
	
};

var cat_back=function(){
	$('#s_con').removeClass('hide');	
	$('#s_con_cat').addClass('hide');
	$('#gg_brand').attr('data-v','');
	$('#gg_con').attr('data-v','');
}

var gg_tamp_htm=function(name,htm){
	 return '<div    class="line1">'
		   +'<div class="title-line2 bottom-title"> <span class="title">'+name+'</span> <span class="selected"></span><i class="down"></i></div>'
		   +'<div class="clear"></div>'
		   +'<div class="brand_list">'
		   +htm
			  //+'<div><span  class="active"><i></i>111</span></div>'
		   +'<div class="clear"></div>'
		   +'</div>'
		   +'</div><div class="clear"></div>';
}

var gg_click=function(){
	$('#gg_brand,#gg_con').find('.gg_item').unbind('click').bind('click',function(){
		//class="active"
		var idd=$(this).attr('id');
		var type=$(this).attr('data-type');
		
		if($('#'+idd).find('span').hasClass('active')==true)
			$('#'+idd).find('span').removeClass('active');
		else
			$('#'+idd).find('span').addClass('active');
	
		if(type==1)
		{
			var brand_id='';
			$('#gg_brand .gg_item').each(function(index, element) {
				if($(this).find('span').hasClass('active')==true)
				{
					brand_id+=(brand_id==''?'':',')+$(this).attr('data-id');
				}
			});
			$('#gg_brand').attr('data-v','search_brand:'+brand_id);
		}
		
		if(type==2)
		{
			var brand_id='';
			$('#gg_con .gg_item').each(function(index, element) {
				if($(this).find('span').hasClass('active')==true)
				{
					brand_id+=(brand_id==''?'':',')+$(this).attr('data-id');
				}
			});
			$('#gg_con').attr('data-v','search_gg_id:'+brand_id);
		}
		
	});
}

var cat_brand=function(catid){
	 var baseTime=new Date();	
	$.post('<{"product/get_brand"|site_url}>?t='+baseTime.getTime(),{brand_id:catid,code:'<{$code}>'},function(msg){
		try
		{ 
			eval("var d="+msg);
			var str='';
			var k=0;
			var brand=d.list;
			for(var df in brand)
			{
				//class="active"
				k++;
				str+='<div data-type="1" id="gg_'+k+'" class="gg_item" data-id="'+brand[df].id+'" ><span ><i></i>'+brand[df].name+'</span></div>';
			}
			
			if(str=='')
				$('#gg_brand').hide();
			else
				$('#gg_brand').show();	
				
			$('#brand_list').html(str);
			var cat=d.gg_list;
			var htm='';
			var gg='';
			str='';
			for(var j in cat)
			{
				//class="active"
				gg=cat[j].gg_con;
				htm='';
				for(var i in gg)
				{
					k++;
					htm+='<div data-type="2" id="gg_'+k+'" class="gg_item" data-id="'+gg[i].id+'"><span ><i></i>'+gg[i].name+'</span></div>';
				}
				str+=gg_tamp_htm(cat[j].name,htm);
			}
			$('#gg_con').html(str);
			gg_click();
		}
		catch(e){}
	})
}

function load_ini()
{
	/*<{*首次加载*}>*/
	cat_brand('<{$smarty.get.search_cat}>');
	$('#search1,#search2,#search3,#search4,#search12,#search13,#search14,#catelogy_back').bind('click',function(){
		var type=$(this).attr('id');
		if(type=='search1')
			$('#SearchCover,#search11').removeClass('hide');
		if(type=='search12'||type=='search13'||type=='search14')	
		{
			resetall();
			$('#search1').addClass('active');
			$('.integrative-list>li').removeClass('checked');
			$(this).addClass('checked');
			$('#search1>span').html($(this).find('.sort-of-brand').html());
			$('#SearchCover,#search11').addClass('hide');
		}
		
		if(type=='search2')
		{
			resetall();
			$(this).addClass('active');
		}
		
		if(type=='search3')
		{
			resetall();
			$('#search3').addClass('active');
			if($('#search3>span').hasClass('arrow-down')==true)
			{
				$('#search3>span').removeClass('arrow-down');
				$('#search3>span').addClass('arrow-up');
			}
			else
			{
				$('#search3>span').removeClass('arrow-up');
				$('#search3>span').addClass('arrow-down');
			}
		}
		
		if(type=='search4')
		{
			$('#con_list').hide();
			$('#search_con').removeClass('hide');
			$('#SearchCover').removeClass('hide').find('.cover-floor').css('z-index','10001');
			$('html').css('height',"100%");
			$('#s_con').height($('#s_con1').height()-44);
			$('#s_con_cat').height($('#s_con1').height());
			$('.classify-ul').height($('#s_con1').height()-45-39);
			$('#cat_show').unbind('click').bind('click',function(){
				$('#s_con').addClass('hide');
				$('#s_con_cat').removeClass('hide');
			});
			
			$('.classify-ul li').each(function(index, element) {
                $(this).unbind('click').bind('click',function(){
					if($('.classify-ul li').eq(index).find('i').hasClass('up')==true)
					{
						$('.classify-ul li i').removeClass('down').addClass('up');
						$(this).find('i').removeClass('up').addClass('down');
						$('.classify-ul div').addClass('hide');
						$('.classify-ul div').eq(index).removeClass('hide');
					}
					else
					{
						$(this).find('i').removeClass('down').addClass('up');
						$('.classify-ul div').addClass('hide');
					}
				});
            });


			$('#s_con_cat .item_cat').each(function(index, element){
				var da=$(this).attr('data-cat');
				$(this).unbind('click').bind('click',function(){  
					eval("var d="+da);
					var id=decodeURI(d.id);
					var cat=decodeURI(d.cat);
					cat_back();
					$('#selected_cat').html(cat);
					$('#selected_cat').attr('data-v',"search_cat:"+d.id);
					/*<{*---------品牌----------*}>*/
					if(d.id!='')
						cat_brand(d.id);
				})
            });
		}
		
		if(type=='catelogy_back')
		{
			cat_back();
		}
	});
	
	$('#submit').bind('click',function(){
		var str='';
		$('#s_con .search_param').each(function(index, element) {
             d=$(this).attr('data-v');
			 var dd=d.split(":");
			 if(dd[1]=='value')
				v=$('#'+dd[0]).val();
			 else
			 	v=dd[1];
			 str+=(str==''?'':"&")+dd[0]+"="+v;
        });
		window.location='<{"product/lists"|site_url}>?'+str;
	});
	
}	
</script> 
